/* CRITICAL MOBILE PERFORMANCE OPTIMIZATIONS */

/* iOS Safari Specific Fixes */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari: Fix 100vh viewport height bug */
  /* Use dynamic viewport height instead of static 100vh */
  .min-h-screen,
  section.min-h-screen {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: 100dvh; /* Dynamic viewport height - iOS 15+ */
  }

  html {
    height: -webkit-fill-available;
  }

  /* iOS Safari: Fix position fixed issues when keyboard opens */
  .fixed {
    position: -webkit-sticky;
    position: fixed;
  }

  /* iOS Safari: Prevent zoom on input focus */
  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="number"],
  select,
  textarea {
    font-size: 16px !important; /* Prevents auto-zoom on iOS */
  }
}

/* Disable backdrop-blur on mobile - HUGE performance boost */
@media (max-width: 768px) {
  .glass,
  .glass-premium,
  .glass-card,
  .btn-glass,
  .card-glass-mobile,
  .bottom-sheet,
  .fab-glass,
  .pull-indicator,
  .tooltip-mobile,
  .skeleton-glass,
  .btn-secondary,
  .btn-ghost,
  .card {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important; /* iOS Safari */
  }

  /* Remove will-change from buttons/cards to free up GPU memory */
  .btn-primary,
  .card {
    will-change: auto !important;
  }

  /* Simplify box-shadows on mobile */
  .glow,
  .glow-primary {
    box-shadow: 0 0 8px rgba(0, 201, 255, 0.15) !important;
  }

  .glow-sm {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
  }

  /* Disable complex animations on mobile */
  .glowing-button::before,
  .shimmer-effect::before {
    display: none !important;
  }

  .orbital-ring,
  .particle {
    animation: none !important;
    will-change: auto !important;
  }

  /* Reduce animation complexity */
  .animate-on-scroll {
    transform: translateY(5px) !important;
    transition: opacity 0.3s ease-out, transform 0.3s ease-out !important;
  }

  /* iOS Safari: Enable smooth momentum scrolling */
  body,
  .scroll-container,
  .overflow-auto,
  .overflow-y-auto {
    -webkit-overflow-scrolling: touch;
  }

  /* iOS Safari: Prevent rubber-band overscroll on body */
  body {
    overscroll-behavior-y: none;
    -webkit-overflow-scrolling: touch;
  }

  /* iOS Safari: Remove 300ms tap delay on all interactive elements */
  a,
  button,
  input,
  select,
  textarea,
  [role="button"],
  [tabindex] {
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  }
}

/* SAFE AREA INSETS for iPhone X+ Notch Support */

/* Safe area utility classes */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
  padding-bottom: max(env(safe-area-inset-bottom), 12px); /* Ensure minimum padding */
}

.safe-area-left {
  padding-left: env(safe-area-inset-left);
}

.safe-area-right {
  padding-right: env(safe-area-inset-right);
}

.safe-area-inset {
  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}

/* Fix for bottom fixed elements (like MobileCTABar) */
.fixed-bottom-safe {
  bottom: 0;
  padding-bottom: env(safe-area-inset-bottom);
}

/* Fix for top fixed elements (like Header) */
.fixed-top-safe {
  top: 0;
  padding-top: env(safe-area-inset-top);
}

/* iOS Safari: Enhanced safe area for bottom navigation/CTA bars */
@supports (-webkit-touch-callout: none) {
  .fixed.bottom-0,
  [class*="fixed"][class*="bottom"] {
    padding-bottom: env(safe-area-inset-bottom, 12px);
  }

  /* Ensure footer respects home indicator on iOS */
  footer {
    padding-bottom: calc(env(safe-area-inset-bottom) + 1rem);
  }
}

/* MOBILE LAYOUT FIX: Prevent horizontal scroll */
@media (max-width: 768px) {
  html,
  body {
    overflow-x: hidden !important;
    width: 100vw !important;
    max-width: 100% !important;
    position: relative;
  }

  /* Ensure body respects safe area on left/right */
  body {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* Fix for any element that might overflow */
  * {
    max-width: 100%;
  }

  /* Container shouldn't exceed viewport */
  .container,
  .container-custom {
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* CRITICAL: Prevent wide elements from causing horizontal scroll */
  section,
  main,
  div {
    max-width: 100vw;
    overflow-x: clip; /* Modern alternative to hidden */
  }

  /* Fix absolute positioned decorative elements */
  section > div[class*="absolute"],
  section > .absolute {
    max-width: 100vw;
    overflow: hidden;
  }

  /* Prevent motion divs from overflowing */
  [style*="motion"],
  [class*="motion"] {
    max-width: 100vw;
    overflow-x: clip;
  }

  /* Grid and flex containers must not overflow */
  .grid,
  [class*="grid"],
  .flex,
  [class*="flex"] {
    max-width: 100%;
    overflow-x: clip;
  }

  /* Images must be responsive */
  img,
  svg,
  video,
  canvas,
  iframe {
    max-width: 100%;
    height: auto;
  }

  /* Text should wrap, not overflow */
  h1, h2, h3, h4, h5, h6, p, span, a, button {
    word-wrap: break-word;
    overflow-wrap: break-word;
    hyphens: auto;
  }

  /* Prevent long words/URLs from breaking layout */
  pre,
  code {
    white-space: pre-wrap;
    word-break: break-all;
    overflow-wrap: break-word;
  }
}

/* MOBILE LAYOUT FIX: Safe padding for all sections */
@media (max-width: 640px) {
  section {
    padding-left: max(1rem, env(safe-area-inset-left));
    padding-right: max(1rem, env(safe-area-inset-right));
  }
}

/* Fix for modal/popup overflow on mobile */
@media (max-width: 768px) {
  .fixed,
  [class*="fixed"] {
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* Exit intent popup fixes */
  [class*="backdrop"],
  [class*="overlay"] {
    overflow-x: hidden;
    max-width: 100vw;
  }
}
