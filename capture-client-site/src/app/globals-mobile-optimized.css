/* CRITICAL MOBILE PERFORMANCE OPTIMIZATIONS */
/* FULL PERFORMANCE MODE - Maximum scrolling smoothness on mobile */

/* =============================================================================
   PHASE 1: DISABLE ALL BACKDROP-BLUR ON MOBILE
   Root cause: 188 backdrop-blur instances cause GPU memory thrashing
   ============================================================================= */

@media (max-width: 768px) {
  /* NUCLEAR OPTION: Remove ALL backdrop-blur on mobile for smooth scrolling */
  /* This catches every Tailwind backdrop-blur class */
  .backdrop-blur-none,
  .backdrop-blur-sm,
  .backdrop-blur,
  .backdrop-blur-md,
  .backdrop-blur-lg,
  .backdrop-blur-xl,
  .backdrop-blur-2xl,
  .backdrop-blur-3xl,
  [class*="backdrop-blur"] {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* ENHANCED MOBILE GLASS - Light blur + enhanced visuals for premium feel */
  .glass,
  .glass-card,
  .glass-surface {
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.85) 0%,
      rgba(248, 250, 252, 0.9) 50%,
      rgba(255, 255, 255, 0.85) 100%
    ) !important;
    backdrop-filter: blur(8px) !important;
    -webkit-backdrop-filter: blur(8px) !important;
    border: 1px solid rgba(226, 232, 240, 0.6) !important;
    box-shadow:
      inset 0 1px 0 rgba(226, 232, 240, 0.3),
      0 8px 32px rgba(0, 0, 0, 0.1),
      0 0 0 1px rgba(0, 201, 255, 0.05) !important;
  }

  /* Premium glass gets extra glow and stronger blur */
  .glass-premium {
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.9) 0%,
      rgba(248, 250, 252, 0.95) 50%,
      rgba(255, 255, 255, 0.9) 100%
    ) !important;
    backdrop-filter: blur(12px) !important;
    -webkit-backdrop-filter: blur(12px) !important;
    border: 1px solid rgba(226, 232, 240, 0.7) !important;
    box-shadow:
      inset 0 1px 0 rgba(226, 232, 240, 0.4),
      inset 0 0 20px rgba(0, 201, 255, 0.03),
      0 8px 32px rgba(0, 0, 0, 0.15),
      0 0 40px rgba(0, 201, 255, 0.08) !important;
  }

  /* Navigation header - solid background instead of blur */
  /* Target only the site navigation header, not semantic section headers */
  nav header,
  header:has(nav),
  banner header,
  [role="banner"] header,
  .fixed-header,
  nav[class*="fixed"] {
    background: rgba(255, 255, 255, 0.98) !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* Ensure section headers within main content stay transparent */
  /* Using high specificity to override the navigation header rule */
  main header,
  main section header,
  section header,
  article header,
  .container-custom header,
  [class*="container"] header {
    background: transparent !important;
    background-color: transparent !important;
  }
}

/* =============================================================================
   PHASE 1: FORCE ALL CONTENT VISIBLE ON MOBILE
   Root cause: Components with initial={{ opacity: 0 }} stay invisible during fast scroll
   ============================================================================= */

@media (max-width: 768px) {
  /* Force all motion/animated elements to be visible immediately */
  /* This prevents black screen during fast scroll */
  [style*="opacity: 0"],
  [style*="opacity:0"] {
    opacity: 1 !important;
  }

  /* Force visibility on all sections and containers */
  section,
  section > div,
  main > div,
  .animate-on-scroll,
  .fade-in,
  .slide-up,
  .slide-in {
    opacity: 1 !important;
    visibility: visible !important;
  }

  /* Remove all transforms that could be mid-animation */
  /* Keep translateZ for GPU acceleration but remove translateY/X delays */
  .animate-on-scroll {
    transform: translateZ(0) !important;
  }

  /* Disable Framer Motion animation delays on mobile */
  [style*="transform: translateY"],
  [style*="transform:translateY"] {
    transform: translateY(0) translateZ(0) !important;
  }
}

/* =============================================================================
   PHASE 1: REDUCE ANIMATION COMPLEXITY
   ============================================================================= */

@media (max-width: 768px) {
  /* Disable infinite animations that cause constant repaints */
  .animate-pulse,
  .animate-bounce,
  .animate-spin,
  .animate-ping,
  [class*="animate-"] {
    animation: none !important;
  }

  /* Exception: Keep essential loading spinners */
  .loading-spinner {
    animation: spin 1s linear infinite !important;
  }

  /* Remove will-change to free GPU memory */
  * {
    will-change: auto !important;
  }

  /* Simplify all transitions to basic opacity/transform */
  * {
    transition-property: opacity, transform !important;
    transition-duration: 0.2s !important;
    transition-timing-function: ease-out !important;
  }

  /* Exception: Allow mobile menu to animate max-height */
  #mobile-menu,
  [id="mobile-menu"],
  header [aria-controls="mobile-menu"] + div {
    transition-property: max-height, opacity !important;
    transition-duration: 0.3s !important;
    transition-timing-function: ease-out !important;
  }
}

/* =============================================================================
   RESPECT REDUCED MOTION PREFERENCE
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* iOS Safari Specific Fixes */
@supports (-webkit-touch-callout: none) {
  /* iOS Safari: Fix 100vh viewport height bug */
  /* Use dynamic viewport height instead of static 100vh */
  .min-h-screen,
  section.min-h-screen {
    min-height: 100vh;
    min-height: -webkit-fill-available;
    min-height: 100dvh; /* Dynamic viewport height - iOS 15+ */
  }

  html {
    height: -webkit-fill-available;
  }

  /* iOS Safari: Fix position fixed issues when keyboard opens */
  .fixed {
    position: -webkit-sticky;
    position: fixed;
  }

  /* iOS Safari: Prevent zoom on input focus */
  input[type="text"],
  input[type="email"],
  input[type="tel"],
  input[type="number"],
  select,
  textarea {
    font-size: 16px !important; /* Prevents auto-zoom on iOS */
  }
}

/* Disable backdrop-blur on mobile - HUGE performance boost */
@media (max-width: 768px) {
  .glass,
  .glass-premium,
  .glass-card,
  .btn-glass,
  .card-glass-mobile,
  .bottom-sheet,
  .fab-glass,
  .pull-indicator,
  .tooltip-mobile,
  .skeleton-glass,
  .btn-secondary,
  .btn-ghost,
  .card {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important; /* iOS Safari */
  }

  /* Remove will-change from buttons/cards to free up GPU memory */
  .btn-primary,
  .card {
    will-change: auto !important;
  }

  /* Simplify box-shadows on mobile */
  .glow,
  .glow-primary {
    box-shadow: 0 0 8px rgba(0, 201, 255, 0.15) !important;
  }

  .glow-sm {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
  }

  /* Disable complex animations on mobile */
  .glowing-button::before,
  .shimmer-effect::before {
    display: none !important;
  }

  .orbital-ring,
  .particle {
    animation: none !important;
    will-change: auto !important;
  }

  /* Reduce animation complexity */
  .animate-on-scroll {
    transform: translateY(5px) !important;
    transition:
      opacity 0.3s ease-out,
      transform 0.3s ease-out !important;
  }

  /* iOS Safari: Enable smooth momentum scrolling */
  body,
  .scroll-container,
  .overflow-auto,
  .overflow-y-auto {
    -webkit-overflow-scrolling: touch;
  }

  /* iOS Safari: Prevent rubber-band overscroll on body */
  body {
    overscroll-behavior-y: none;
    -webkit-overflow-scrolling: touch;
  }

  /* CRITICAL: Prevent scroll traps in nested scrollable elements */
  /* This allows scrolling to "escape" from nested containers back to body */
  [class*="overflow-y-auto"],
  [class*="overflow-scroll"],
  [class*="max-h-"] {
    overscroll-behavior: contain;
    -webkit-overscroll-behavior: contain;
  }

  /* When nested scroll container reaches boundary, allow parent scroll */
  .scroll-container,
  [class*="overflow-y-auto"]:not(body) {
    overscroll-behavior-y: contain;
  }

  /* iOS Safari: Remove 300ms tap delay on all interactive elements */
  a,
  button,
  input,
  select,
  textarea,
  [role="button"],
  [tabindex] {
    touch-action: manipulation;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  }
}

/* SAFE AREA INSETS for iPhone X+ Notch Support */

/* Safe area utility classes */
.safe-area-top {
  padding-top: env(safe-area-inset-top);
}

.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom);
  padding-bottom: max(env(safe-area-inset-bottom), 12px); /* Ensure minimum padding */
}

.safe-area-left {
  padding-left: env(safe-area-inset-left);
}

.safe-area-right {
  padding-right: env(safe-area-inset-right);
}

.safe-area-inset {
  padding-top: env(safe-area-inset-top);
  padding-right: env(safe-area-inset-right);
  padding-bottom: env(safe-area-inset-bottom);
  padding-left: env(safe-area-inset-left);
}

/* Fix for bottom fixed elements (like MobileCTABar) */
.fixed-bottom-safe {
  bottom: 0;
  padding-bottom: env(safe-area-inset-bottom);
}

/* Fix for top fixed elements (like Header) */
.fixed-top-safe {
  top: 0;
  padding-top: env(safe-area-inset-top);
}

/* iOS Safari: Enhanced safe area for bottom navigation/CTA bars */
@supports (-webkit-touch-callout: none) {
  .fixed.bottom-0,
  [class*="fixed"][class*="bottom"] {
    padding-bottom: env(safe-area-inset-bottom, 12px);
  }

  /* Ensure footer respects home indicator on iOS */
  footer {
    padding-bottom: calc(env(safe-area-inset-bottom) + 1rem);
  }
}

/* MOBILE LAYOUT FIX: Prevent horizontal scroll */
@media (max-width: 768px) {
  html,
  body {
    overflow-x: hidden !important;
    width: 100vw !important;
    max-width: 100% !important;
    position: relative;
  }

  /* Ensure body respects safe area on left/right */
  body {
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }

  /* Fix for any element that might overflow */
  * {
    max-width: 100%;
  }

  /* Container shouldn't exceed viewport */
  .container,
  .container-custom {
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* CRITICAL: Prevent wide elements from causing horizontal scroll */
  section,
  main,
  div {
    max-width: 100vw;
    overflow-x: clip; /* Modern alternative to hidden */
  }

  /* Fix absolute positioned decorative elements */
  section > div[class*="absolute"],
  section > .absolute {
    max-width: 100vw;
    overflow: hidden;
  }

  /* Prevent motion divs from overflowing */
  [style*="motion"],
  [class*="motion"] {
    max-width: 100vw;
    overflow-x: clip;
  }

  /* Grid and flex containers must not overflow */
  .grid,
  [class*="grid"],
  .flex,
  [class*="flex"] {
    max-width: 100%;
    overflow-x: clip;
  }

  /* EXCEPTION: Allow horizontal scrollable containers to work */
  .overflow-x-auto {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Parents of scrollable containers need visible overflow */
  .overflow-x-auto,
  .overflow-x-auto > * {
    max-width: none;
  }

  /* Utility class to allow overflow in parent containers - must override .container rule */
  .container.allow-overflow-x,
  .container-custom.allow-overflow-x,
  div.allow-overflow-x,
  .allow-overflow-x {
    overflow-x: visible !important;
    overflow: visible !important;
  }

  /* Images must be responsive */
  img,
  svg,
  video,
  canvas,
  iframe {
    max-width: 100%;
    height: auto;
  }

  /* Text should wrap, not overflow - but NEVER hyphenate headings */
  p,
  span,
  a,
  button {
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Headings: NEVER hyphenate - scale down instead */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    hyphens: none !important;
    -webkit-hyphens: none !important;
    word-break: normal;
    overflow-wrap: normal;
  }

  /* Prevent long words/URLs from breaking layout */
  pre,
  code {
    white-space: pre-wrap;
    word-break: break-all;
    overflow-wrap: break-word;
  }
}

/* MOBILE LAYOUT FIX: Safe padding for all sections */
@media (max-width: 640px) {
  section {
    padding-left: max(1rem, env(safe-area-inset-left));
    padding-right: max(1rem, env(safe-area-inset-right));
  }
}

/* Fix for modal/popup overflow on mobile */
@media (max-width: 768px) {
  .fixed,
  [class*="fixed"] {
    max-width: 100vw;
    overflow-x: hidden;
  }

  /* Exit intent popup fixes */
  [class*="backdrop"],
  [class*="overlay"] {
    overflow-x: hidden;
    max-width: 100vw;
  }
}

/* =============================================================================
   PHASE 3: MOBILE DESIGN POLISH - GPU-FRIENDLY SIMPLIFICATION
   ============================================================================= */

@media (max-width: 768px) {
  /* 3.1 EDGE-TO-EDGE GLASS CARDS - Maximum width on mobile for glassy feel */
  .glass,
  .glass-premium,
  .glass-card,
  .glass-surface {
    /* Allow the gradient backgrounds from Phase 1 to show */
    margin-left: -0.5rem !important;
    margin-right: -0.5rem !important;
    border-radius: 1rem !important;
  }

  /* Cards within container should be wider */
  .container-custom .glass-premium,
  .container-custom .glass-card,
  [class*="max-w-"] .glass-premium,
  [class*="max-w-"] .glass-card {
    margin-left: -0.25rem !important;
    margin-right: -0.25rem !important;
  }

  /* 3.2 Premium shadow glow for glass cards */
  .glass-premium {
    box-shadow:
      inset 0 1px 0 rgba(226, 232, 240, 0.4),
      inset 0 0 20px rgba(0, 201, 255, 0.03),
      0 8px 32px rgba(0, 0, 0, 0.15),
      0 0 40px rgba(0, 201, 255, 0.08) !important;
  }

  .glass-card {
    box-shadow:
      inset 0 1px 0 rgba(226, 232, 240, 0.3),
      0 8px 32px rgba(0, 0, 0, 0.1),
      0 0 0 1px rgba(0, 201, 255, 0.05) !important;
  }

  /* Keep subtle shadows on other elements */
  .shadow-glow,
  .shadow-glow-lg,
  .shadow-glow-sm {
    box-shadow: 0 4px 20px rgba(0, 201, 255, 0.15) !important;
  }

  /* 3.3 Hide Decorative Elements - Free up GPU memory */
  [class*="blur-3xl"],
  [class*="blur-2xl"],
  .floating-orb,
  .decorative-blob,
  .bg-gradient-radial {
    display: none !important;
  }

  /* Exception: Keep blur on actual content (not decorative) */
  img[class*="blur"],
  .blur-placeholder {
    display: block !important;
  }

  /* 3.4 Disable Shimmer and Infinite Animations */
  .glass-shimmer-enhanced::before,
  .shimmer-effect::before,
  [class*="shimmer"] {
    animation: none !important;
    display: none !important;
  }

  /* 3.5 Simplify Border Effects */
  [class*="border-gradient"],
  .border-glow {
    border-image: none !important;
    border-color: rgba(255, 255, 255, 0.1) !important;
  }

  /* 3.6 Remove Hover Transform Effects */
  .group:hover .group-hover\:scale-105,
  .group:hover .group-hover\:scale-110,
  .group:hover [class*="group-hover\:scale"] {
    transform: none !important;
  }

  /* 3.7 Disable Interactive Glow Tracking */
  [style*="radial-gradient"][style*="circle at"] {
    background: transparent !important;
  }

  /* 3.8 Tighten Vertical Spacing */
  .section {
    padding-top: 3rem !important;
    padding-bottom: 3rem !important;
  }

  .mb-12 {
    margin-bottom: 2rem !important;
  }
  .mb-16 {
    margin-bottom: 2.5rem !important;
  }
  .mb-20 {
    margin-bottom: 3rem !important;
  }
  .mt-12 {
    margin-top: 2rem !important;
  }
  .mt-16 {
    margin-top: 2.5rem !important;
  }
  .mt-20 {
    margin-top: 3rem !important;
  }
  .py-12 {
    padding-top: 2rem !important;
    padding-bottom: 2rem !important;
  }
  .py-16 {
    padding-top: 2.5rem !important;
    padding-bottom: 2.5rem !important;
  }
  .py-20 {
    padding-top: 3rem !important;
    padding-bottom: 3rem !important;
  }
}

/* =============================================================================
   PHASE 3: TYPOGRAPHY POLISH
   ============================================================================= */

@media (max-width: 768px) {
  /* Smooth font scaling for headings */
  h1 {
    font-size: clamp(1.75rem, 7vw, 2.5rem) !important;
    line-height: 1.2 !important;
  }

  h2 {
    font-size: clamp(1.5rem, 6vw, 2rem) !important;
    line-height: 1.25 !important;
  }

  h3 {
    font-size: clamp(1.25rem, 5vw, 1.5rem) !important;
    line-height: 1.3 !important;
  }
}

/* =============================================================================
   MOBILE 3D TRANSFORM FIXES - Prevent blurry text
   3D transforms (preserve-3d, perspective) cause text
   rendering issues on mobile devices
   ============================================================================= */
@media (max-width: 768px), (hover: none) {
  /* Disable preserve-3d on all elements */
  [style*="preserve-3d"],
  .preserve-3d {
    transform-style: flat !important;
  }

  /* Reset perspective that causes text blur */
  [style*="perspective"] {
    perspective: none !important;
  }

  /* Disable rotateX/rotateY transforms that cause blur */
  [style*="rotateX"],
  [style*="rotateY"] {
    transform: none !important;
  }

  /* Ensure text rendering is optimized */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  p,
  span,
  a,
  button,
  label {
    -webkit-font-smoothing: antialiased !important;
    -moz-osx-font-smoothing: grayscale !important;
    text-rendering: optimizeLegibility !important;
  }

  /* Force flat transforms on card components */
  .perspective-container,
  [data-perspective] {
    perspective: none !important;
    transform-style: flat !important;
  }

  /* Remove will-change that can cause compositing issues */
  .transform-3d,
  [data-transform-3d] {
    transform-style: flat !important;
    will-change: auto !important;
    transform: none !important;
  }
}

/* =============================================================================
   SCROLL TRAP FIXES - Prevent scroll blocking on interactive elements
   ============================================================================= */
@media (max-width: 768px) {
  /* Allow vertical scroll to escape from horizontal scroll containers */
  [style*="overflow-x: auto"],
  .overflow-x-auto {
    touch-action: pan-x pan-y !important;
  }

  /* Range inputs should not block vertical scroll */
  input[type="range"] {
    touch-action: pan-y !important;
  }
}
