# Core Web Vitals Monitoring - System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER VISITS WEBSITE                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Next.js App (layout.tsx)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         <WebVitals /> Component Rendered                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WebVitals Component (Client-side)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  useEffect()     â”‚    â”‚  useReportWebVitals()           â”‚  â”‚
â”‚  â”‚  â”œâ”€ initWebVitals()â”‚  â”‚  (Next.js built-in hook)        â”‚  â”‚
â”‚  â”‚  â””â”€ Import web-   â”‚  â”‚                                  â”‚  â”‚
â”‚  â”‚     vitals libraryâ”‚  â”‚                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                â”‚
                     â–¼                â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ web-vitals Library â”‚  â”‚ Next.js Web Vitals  â”‚
        â”‚ (Direct import)    â”‚  â”‚ (Built-in tracking) â”‚
        â”‚                    â”‚  â”‚                     â”‚
        â”‚ â€¢ onCLS()         â”‚  â”‚ â€¢ CLS               â”‚
        â”‚ â€¢ onLCP()         â”‚  â”‚ â€¢ LCP               â”‚
        â”‚ â€¢ onFCP()         â”‚  â”‚ â€¢ FCP               â”‚
        â”‚ â€¢ onTTFB()        â”‚  â”‚ â€¢ TTFB              â”‚
        â”‚ â€¢ onINP()         â”‚  â”‚ â€¢ INP               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚                â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   reportWebVitals(metric)                    â”‚
        â”‚   (src/lib/performance.ts)                   â”‚
        â”‚                                              â”‚
        â”‚   â€¢ Calculate enhanced rating                â”‚
        â”‚   â€¢ Format values                            â”‚
        â”‚   â€¢ Compare to thresholds                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â–¼                     â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  DEVELOPMENT    â”‚   â”‚   PRODUCTION        â”‚
        â”‚                 â”‚   â”‚                     â”‚
        â”‚  logMetric()    â”‚   â”‚  sendToAnalytics()  â”‚
        â”‚  â€¢ Console log  â”‚   â”‚  â€¢ Custom endpoint  â”‚
        â”‚  â€¢ Emoji rating â”‚   â”‚  â€¢ sendBeacon()     â”‚
        â”‚  â€¢ Percentage   â”‚   â”‚  â€¢ keepalive fetch  â”‚
        â”‚  â€¢ Warnings     â”‚   â”‚                     â”‚
        â”‚  â€¢ Actionable   â”‚   â”‚  sendToGA()         â”‚
        â”‚    tips         â”‚   â”‚  â€¢ Google Analytics â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â€¢ Event tracking   â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  /api/analytics Endpoint  â”‚
                        â”‚  (route.ts)               â”‚
                        â”‚                           â”‚
                        â”‚  â€¢ Receive metric         â”‚
                        â”‚  â€¢ Validate data          â”‚
                        â”‚  â€¢ Enhance analysis       â”‚
                        â”‚  â€¢ Log to server          â”‚
                        â”‚  â€¢ Send to backends       â”‚
                        â”‚  â€¢ Trigger alerts         â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â–¼                               â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Google Analyticsâ”‚          â”‚  Custom Backend  â”‚
              â”‚ Measurement API â”‚          â”‚  (Database, etc) â”‚
              â”‚                 â”‚          â”‚                  â”‚
              â”‚ â€¢ Event trackingâ”‚          â”‚ â€¢ Historical     â”‚
              â”‚ â€¢ Real-time     â”‚          â”‚   storage        â”‚
              â”‚ â€¢ Reporting     â”‚          â”‚ â€¢ Dashboards     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â€¢ Alerts         â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Diagram

### 1. Metric Capture

```
Browser Performance API
         â”‚
         â–¼
web-vitals Library (observes)
         â”‚
         â”œâ”€ LCP measured when largest element painted
         â”œâ”€ CLS measured continuously (cumulative)
         â”œâ”€ INP measured on interactions
         â”œâ”€ FCP measured at first content paint
         â””â”€ TTFB measured from navigation start
         â”‚
         â–¼
reportWebVitals(metric) called with:
         {
           name: "LCP",
           value: 2341,
           rating: "good",
           delta: 2341,
           id: "v3-1701234567890-123",
           navigationType: "navigate",
           entries: [...]
         }
```

### 2. Metric Processing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ reportWebVitals(metric)                                      â”‚
â”‚ (src/lib/performance.ts)                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚ 1. Get thresholds from PERFORMANCE_THRESHOLDS               â”‚
â”‚    Target: 2000ms, Good: 2500ms, Poor: 4000ms               â”‚
â”‚                                                              â”‚
â”‚ 2. Calculate enhanced rating                                â”‚
â”‚    Value 2341ms vs thresholds â†’ "good"                      â”‚
â”‚                                                              â”‚
â”‚ 3. Calculate percentages                                    â”‚
â”‚    % of target: 2341/2000 = 117%                           â”‚
â”‚    % of good: 2341/2500 = 94%                              â”‚
â”‚                                                              â”‚
â”‚ 4. Format value                                             â”‚
â”‚    2341 â†’ "2341ms"                                          â”‚
â”‚                                                              â”‚
â”‚ 5. Generate emoji                                           â”‚
â”‚    "good" â†’ âœ…                                              â”‚
â”‚                                                              â”‚
â”‚ 6. Create detailed log message                              â”‚
â”‚    âœ… [Web Vitals] LCP: 2341ms                             â”‚
â”‚    ğŸ“Š Analysis: { ... }                                     â”‚
â”‚    â„¹ï¸ INFO: good but not excellent                         â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Distribution to Endpoints

```
Development Mode:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Browser     â”‚
â”‚ Console.log â”‚ â†’ Developer sees metrics immediately
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Production Mode:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Custom Endpoint â”‚ â†’ POST /api/analytics
â”‚ (sendBeacon)    â”‚    â€¢ Server logs
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â€¢ Database storage
                       â€¢ Alert triggers

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Analyticsâ”‚ â†’ gtag('event', ...)
â”‚ (if configured) â”‚    â€¢ GA4 Dashboard
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â€¢ Standard reports

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Vercel Analyticsâ”‚ â†’ Automatic (if installed)
â”‚ (optional)      â”‚    â€¢ Vercel Dashboard
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â€¢ Built-in reports
```

---

## Component Hierarchy

```
RootLayout (src/app/layout.tsx)
â”‚
â”œâ”€ Header
â”‚
â”œâ”€ main#main-content
â”‚  â”‚
â”‚  â””â”€ {children} â† Page content
â”‚
â”œâ”€ Footer
â”‚
â””â”€ Analytics Components (deferred loading)
   â”‚
   â”œâ”€ <GoogleAnalytics />
   â”‚  â””â”€ Loads gtag script
   â”‚
   â”œâ”€ <WebVitals />  â† OUR MONITORING COMPONENT
   â”‚  â”œâ”€ useEffect â†’ initWebVitals()
   â”‚  â”‚  â””â”€ Imports web-vitals library
   â”‚  â”‚     â”œâ”€ onCLS(reportWebVitals)
   â”‚  â”‚     â”œâ”€ onLCP(reportWebVitals)
   â”‚  â”‚     â”œâ”€ onFCP(reportWebVitals)
   â”‚  â”‚     â”œâ”€ onTTFB(reportWebVitals)
   â”‚  â”‚     â””â”€ onINP(reportWebVitals)
   â”‚  â”‚
   â”‚  â””â”€ useReportWebVitals((metric) => {
   â”‚     â””â”€ reportWebVitals(metric)
   â”‚        â”œâ”€ logMetric() if dev
   â”‚        â”œâ”€ sendToAnalytics() if prod
   â”‚        â””â”€ sendToGoogleAnalytics() if prod
   â”‚     })
   â”‚
   â””â”€ <ScrollDepthTracker />
      â””â”€ Tracks scroll depth
```

---

## File Dependency Graph

```
src/app/layout.tsx
     â”‚
     â”œâ”€ imports: @/components/analytics/WebVitals
     â”‚            â””â”€â”€â”€ src/components/analytics/WebVitals.tsx
     â”‚                      â”‚
     â”‚                      â”œâ”€ imports: next/web-vitals
     â”‚                      â”‚           (Next.js built-in)
     â”‚                      â”‚
     â”‚                      â”œâ”€ imports: web-vitals (package)
     â”‚                      â”‚           (npm package)
     â”‚                      â”‚
     â”‚                      â””â”€ imports: @/lib/performance
     â”‚                                   â””â”€â”€â”€ src/lib/performance.ts
     â”‚                                            â”‚
     â”‚                                            â”œâ”€ imports: web-vitals
     â”‚                                            â”‚           (types)
     â”‚                                            â”‚
     â”‚                                            â””â”€ exports:
     â”‚                                                â€¢ PERFORMANCE_THRESHOLDS
     â”‚                                                â€¢ reportWebVitals()
     â”‚                                                â€¢ initWebVitals()
     â”‚                                                â€¢ getMetricRating()
     â”‚                                                â€¢ formatMetricValue()
     â”‚                                                â€¢ performanceMark
     â”‚
     â””â”€ imports: @/components/analytics/GoogleAnalytics
                 (existing component)

Metrics sent to:
     â”‚
     â”œâ”€ Browser console (dev mode)
     â”‚
     â””â”€ POST /api/analytics (prod mode)
              â””â”€â”€â”€ src/app/api/analytics/route.ts
                        â”‚
                        â”œâ”€ imports: @/lib/performance
                        â”‚           â€¢ PERFORMANCE_THRESHOLDS
                        â”‚           â€¢ getMetricRating()
                        â”‚           â€¢ formatMetricValue()
                        â”‚
                        â””â”€ Sends to:
                           â”œâ”€ Console logs (server)
                           â”œâ”€ Google Analytics (if configured)
                           â”œâ”€ Custom database (if configured)
                           â””â”€ Alert system (if configured)
```

---

## Timing Diagram

```
Page Load Timeline:
â”‚
â”œâ”€ 0ms: Navigation starts
â”‚  â””â”€ TTFB starts measuring
â”‚
â”œâ”€ 400ms: Server responds (TTFB measured)
â”‚  â””â”€ TTFB reported: âœ… 387ms (excellent)
â”‚
â”œâ”€ 1200ms: First content painted (FCP measured)
â”‚  â””â”€ FCP reported: âœ… 1142ms (excellent)
â”‚
â”œâ”€ 2000ms: Largest element painted (LCP measured)
â”‚  â””â”€ LCP reported: ğŸš€ 1834ms (excellent)
â”‚
â”œâ”€ Throughout: Layout shifts tracked
â”‚  â””â”€ CLS measured continuously
â”‚
â”œâ”€ On first interaction: INP measured
â”‚  â””â”€ INP reported: âœ… 87ms (good)
â”‚
â””â”€ Page unload: Final CLS reported
   â””â”€ CLS reported: ğŸš€ 0.042 (excellent)

All metrics sent to:
â”œâ”€ Console (dev): Immediate feedback
â””â”€ /api/analytics (prod): Logged for analysis
```

---

## Performance Budget Enforcement

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Metric Measured                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Compare to Budget  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Target  â”‚    â”‚  Good   â”‚    â”‚  Poor   â”‚
    â”‚  2.0s   â”‚    â”‚  2.5s   â”‚    â”‚  4.0s   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼
    Value â‰¤ 2.0s   2.0s < v â‰¤ 2.5s   2.5s < v â‰¤ 4.0s   v > 4.0s
          â”‚              â”‚              â”‚              â”‚
          â–¼              â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ğŸš€Excellentâ”‚   â”‚âœ… Good   â”‚   â”‚âš¡Needs   â”‚   â”‚âš ï¸ Poor   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚Improve   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚              â”‚              â”‚              â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Log with appropriate  â”‚
                    â”‚  emoji and message     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Send to analytics     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                           â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ If "poor"     â”‚         â”‚ Otherwise    â”‚
            â”‚ â†’ Trigger     â”‚         â”‚ â†’ Normal     â”‚
            â”‚   alert       â”‚         â”‚   logging    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Metric Capture Attempt                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Try to import      â”‚
              â”‚ web-vitals library â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Success  â”‚                  â”‚  Error   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                             â”‚
          â–¼                             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Initialize       â”‚    â”‚ console.error()       â”‚
    â”‚ observers        â”‚    â”‚ "Failed to init..."   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚                       â”‚
          â”‚                 â”‚ Silent failure -      â”‚
          â–¼                 â”‚ doesn't break site    â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ Metrics reported â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Try to send      â”‚
    â”‚ to analytics     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Success â”‚  â”‚ Error  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚           â”‚
    â–¼           â–¼
Logged   Silent failure
         (catch block)
         User experience
         not affected
```

---

## Scaling Strategy

```
Current (Single Server):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚ â†’ Metrics â†’ /api/analytics â†’ Server Console
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Future (Multiple Analytics):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Browser   â”‚ â†’ Metrics â†’ /api/analytics
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â–¼            â–¼            â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Database â”‚  â”‚    GA4   â”‚  â”‚  Alerts  â”‚
              â”‚ Storage  â”‚  â”‚          â”‚  â”‚  System  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Dashboard  â”‚
            â”‚   (Admin)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

This architecture ensures:
1. Non-blocking performance monitoring
2. Graceful degradation on errors
3. Development and production modes
4. Extensible for multiple analytics backends
5. Actionable insights for developers
6. Real-world performance tracking
